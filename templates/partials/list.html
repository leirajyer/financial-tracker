{% if not records %}
<div class="p-10 text-center">
  <p class="text-slate-400 italic">
    No installments found. Start by adding one above!
  </p>
</div>
{% else %}
<div class="overflow-x-auto">
  <table class="w-full text-left border-collapse">
    <thead>
      <tr class="bg-slate-50 text-slate-500 text-xs uppercase tracking-wider border-b">
        <th class="p-4 font-semibold">Description</th>
        <th class="p-4 font-semibold">Card</th>
        <th class="p-4 font-semibold">Payee</th>
        <th class="p-4 font-semibold">Monthly</th>
        <th class="p-4 font-semibold">Timeline</th>
        <th class="p-4 font-semibold">Starts</th>
        <th class="p-4 font-semibold">Ends</th>
        <th class="p-4 font-semibold">Remaining of Total</th>
        <th class="p-4 font-semibold text-right">Action</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-slate-100">
      {% for rec in records %}
      <tr id="row-{{ rec.id }}" class="hover:bg-slate-50 transition-colors group">
        <td class="p-4 text-sm font-medium text-slate-700">
          {{ rec.description }}
        </td>

        <td class="p-4 text-sm text-slate-600">
          {% if rec.card %}
          <span class="px-2 py-1 bg-blue-50 text-blue-700 rounded-md text-xs font-bold">
            {{ rec.card.name }}
          </span>
          {% else %}
          <span class="text-slate-300 italic text-xs">Deleted Card</span>
          {% endif %}
        </td>

        <td class="p-4 text-sm text-slate-600">
          {% if rec.payee %} {{ rec.payee.name }} {% else %}
          <span class="text-slate-300 italic text-xs">-</span>
          {% endif %}
        </td>

        <td class="p-4 text-sm font-bold text-indigo-600">
          ₱{{ "{:,.2f}".format(rec.monthly_payment) }}
        </td>

        <td class="p-4">
          {% set prog = rec.get_progress() %}
          <div class="flex flex-col gap-1 w-32">
            <div class="flex justify-between text-[10px] font-bold text-slate-400 uppercase">
              <span>Month</span>
              <span>{{ prog.current }}/{{ prog.total }}</span>
            </div>
            <div class="w-full bg-slate-200 rounded-full h-1.5 overflow-hidden">
              <div class="bg-indigo-500 h-full transition-all duration-700"></div>
            </div>
          </div>
        </td>

        <td class="p-4 text-sm text-slate-500">
          {{ rec.start_date.strftime("%d %b %Y") if rec.start_date else "N/A" }}
        </td>

        <td class="p-4 text-sm text-slate-500">
          {{ rec.end_date.strftime("%b %Y") if rec.end_date else "N/A" }}
        </td>

        <td class="p-4 text-sm font-medium text-slate-900">
          <div class="flex items-baseline gap-1">
            <span class="text-orange-400 font-bold">₱{{ "{:,.2f}".format(rec.get_remaining_balance()) }}</span>
            <span class="text-[10px] text-slate-400 font-normal">of</span>
            <span class="text-emerald-600 text-xs">₱{{ "{:,.2f}".format(rec.total_amount) }}</span>
          </div>

          <p class="text-[10px] text-slate-400 font-normal mt-1">
            {% set prog = rec.get_progress() %} {% set left = prog.total -
            prog.current %} {% if prog.total == 1 %}
            <span class="text-amber-600 font-bold uppercase text-[9px]">Straight Payment</span>
            {% else %} {{ left }} {{ 'month' if left == 1 else 'months' }} left
            {% endif %}
          </p>
        </td>

        <td class="p-4 text-right">
          <button hx-delete="/delete-installment/{{ rec.id }}" hx-confirm="Are you sure you want to delete this?"
            hx-target="#installment-list-container" hx-swap="innerHTML"
            class="opacity-1 group-hover:opacity-100 transition-opacity text-slate-300 hover:text-red-500">
            ❌
          </button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}